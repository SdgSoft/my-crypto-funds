<form [formGroup]="dataForm" class="form-card" (ngSubmit)="onSubmitHandler()">
    <div class="header-section">
        <h2 class="page-title">{{headerText()}}</h2>
        <div class="main-actions-container">
            @if (backLink()) {
                <a [routerLink]="backLink()">
                    <button class="btn-common btn-back">
                        <ng-icon name="heroArrowLeft" class="text-xl"></ng-icon>
                        Back
                    </button>
                </a>
            }
        </div>
    </div>

    <fieldset [disabled]="isReadonly()" class="space-y-4">
        @for (field of config(); track field.key) {
            <div class="form-group">
                <!-- Label with Asterisk -->
                <label [for]="field.key" class="form-label">
                    {{field.label}}:
                    @if (requiredFields().get(field.key)) {
                        <span class="text-red-600 font-bold" aria-hidden="true">*</span>
                    }
                </label>

                @if (field.type === 'select') {
                    <select
                        [id]="field.key"
                        [name]="field.key"
                        class="form-input"
                        [formControlName]="field.key"
                    >
                        <option [ngValue]="null" [disabled]="requiredFields().get(field.key)">Select {{field.label}}</option>
                        @for (opt of field.options; track opt.value) {
                            <option [value]="opt.value">{{opt.label}}</option>
                        }
                    </select>
                } @else {
                    @if (!field.format) {
                        <input
                            [id]="field.key"
                            [name]="field.key"
                            [type]="field.type"
                            class="form-input"
                            [formControlName]="field.key"
                        >
                    } @else {
                        <input
                            [id]="field.key"
                            [name]="field.key"
                            [type]="field.type"
                            class="form-input"
                            [formControlName]="field.key"
                            [appFormattedInput]="field.format"
                        >
                    }
                }
                @if (dataForm.get(field.key)?.invalid && (dataForm.get(field.key)?.dirty || dataForm.get(field.key)?.touched)) {
                    <div class='error'>
                        @if (dataForm.get(field.key)?.errors?.['required']) {
                            <small class="form-error">{{field.key}} is required.</small>
                        }
                    </div>
                }
            </div>
        }

        @if (!isReadonly()) {
            <button
                type="submit"
                class="form-button mt-4 disabled:opacity-50 disabled:cursor-not-allowed"
                [disabled]="dataForm.invalid">
                {{buttonText()}}
            </button>
        }
    </fieldset>
</form>
